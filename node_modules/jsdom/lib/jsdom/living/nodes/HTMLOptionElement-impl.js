"use strict";
<<<<<<< HEAD
=======

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
const HTMLElementImpl = require("./HTMLElement-impl").implementation;
const { stripAndCollapseASCIIWhitespace } = require("../helpers/strings");
const { domSymbolTree } = require("../helpers/internal-constants");
const { closest } = require("../helpers/traversal");
<<<<<<< HEAD
=======
const { formOwner } = require("../helpers/form-controls");
>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03

class HTMLOptionElementImpl extends HTMLElementImpl {
  constructor(args, privateData) {
    super(args, privateData);

    // whenever selectedness is set to true, make sure all
    // other options set selectedness to false
    this._selectedness = false;
    this._dirtyness = false;
  }
<<<<<<< HEAD
=======

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  _removeOtherSelectedness() {
    // Remove the selectedness flag from all other options in this select
    const select = this._selectNode;

<<<<<<< HEAD
    if (select && !select.hasAttribute("multiple")) {
=======
    if (select && !select.hasAttributeNS(null, "multiple")) {
>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
      for (const option of select.options) {
        if (option !== this) {
          option._selectedness = false;
        }
      }
    }
  }
<<<<<<< HEAD
=======

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  _askForAReset() {
    const select = this._selectNode;
    if (select) {
      select._askedForAReset();
    }
  }
<<<<<<< HEAD
  _attrModified(name) {
    if (!this._dirtyness && name === "selected") {
      this._selectedness = this.hasAttribute("selected");
=======

  _attrModified(name) {
    if (!this._dirtyness && name === "selected") {
      this._selectedness = this.hasAttributeNS(null, "selected");
>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
      if (this._selectedness) {
        this._removeOtherSelectedness();
      }
      this._askForAReset();
    }
    super._attrModified.apply(this, arguments);
  }
<<<<<<< HEAD
=======

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  get _selectNode() {
    let select = domSymbolTree.parent(this);
    if (!select) {
      return null;
    }

    if (select.nodeName.toUpperCase() !== "SELECT") {
      select = domSymbolTree.parent(select);
      if (!select || select.nodeName.toUpperCase() !== "SELECT") {
        return null;
      }
    }
    return select;
  }
<<<<<<< HEAD
  get form() {
    return closest(this, "form");
  }
=======

  get form() {
    return formOwner(this);
  }

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  get text() {
    // TODO is not correctly excluding script and SVG script descendants
    return stripAndCollapseASCIIWhitespace(this.textContent);
  }
<<<<<<< HEAD
  set text(V) {
    this.textContent = V;
  }

  get value() {
    return this.hasAttribute("value") ? this.getAttribute("value") : this.text;
  }
  set value(val) {
    this.setAttribute("value", val);
  }
=======
  set text(value) {
    this.textContent = value;
  }

  get value() {
    if (this.hasAttributeNS(null, "value")) {
      return this.getAttributeNS(null, "value");
    }

    return this.text;
  }
  set value(value) {
    this.setAttributeNS(null, "value", value);
  }

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  get index() {
    const select = closest(this, "select");
    if (select === null) {
      return 0;
    }

    return select.options.indexOf(this);
  }
<<<<<<< HEAD
=======

>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  get selected() {
    return this._selectedness;
  }
  set selected(s) {
    this._dirtyness = true;
    this._selectedness = Boolean(s);
    if (this._selectedness) {
      this._removeOtherSelectedness();
    }
    this._askForAReset();
<<<<<<< HEAD
  }

  // TODO this is quite wrong
  get label() {
    if (this.hasAttribute("label")) {
      return this.getAttribute("label");
    }
    const select = this._selectNode;
    if (select) {
      return select.getAttribute("label");
    }
    return null;
  }

  set label(V) {
    const select = this._selectNode;
    if (select) {
      select.setAttribute("label", V);
    }
=======
    this._modified();
  }

  get label() {
    if (this.hasAttributeNS(null, "label")) {
      return this.getAttributeNS(null, "label");
    }

    return this.text;
  }
  set label(value) {
    this.setAttributeNS(null, "label", value);
>>>>>>> 39a8ac91c1203e59702c1b86c18a4c5e5058db03
  }
}

module.exports = {
  implementation: HTMLOptionElementImpl
};

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core");function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=n(e),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a.apply(this,arguments)},i=function(e){var n=e.getPageIndex,a=e.store,i=r.useState(),u=i[0],c=i[1],o=function(e){c(e)},l=window.devicePixelRatio||1,s=r.useRef(),g=r.useRef(),h=r.useState(!1),p=h[0],f=h[1];return r.useEffect((function(){if(u){var e=g.current,t=s.current;if(e&&t){var r=u.numPages,a=n?n({numPages:r}):0,i=Math.max(0,Math.min(a,r-1));u.getPage(i+1).then((function(n){var r=n.getViewport({scale:1}),a=r.width,i=r.height,u=e.clientWidth,c=e.clientHeight,o=Math.min(u/a,c/i),s=o*a,g=o*i;t.height=g*l,t.width=s*l,t.style.opacity="0";var h=t.getContext("2d",{alpha:!1}),p=n.getViewport({rotation:0,scale:o*l});n.render({canvasContext:h,viewport:p}).promise.then((function(){f(!0),t.style.removeProperty("opacity")}),(function(){f(!0)}))}))}}}),[u]),r.useEffect((function(){return a.subscribe("doc",o),function(){a.unsubscribe("doc",o)}}),[]),r.createElement("div",{className:"rpv-thumbnail__cover",ref:g},!p&&r.createElement("div",{className:"rpv-thumbnail__cover-loader"},r.createElement(t.Spinner,null)),r.createElement("canvas",{ref:s,style:{transform:"scale("+1/l+")",transformOrigin:"top left"}}))},u=function(e){var n=e.children,a=e.doc,i=r.useState(),u=i[0],c=i[1];return r.useEffect((function(){a.getPageLabels().then((function(e){c(e||[])}))}),[a]),u?n(u):r.createElement("div",{className:"rpv-thumbnail__loader"},r.createElement(t.Spinner,null))},c=function(e){var n=e.page,a=e.pageHeight,i=e.pageIndex,u=e.pageWidth,c=e.rotation,o=e.thumbnailHeight,l=e.thumbnailWidth,s=r.useContext(t.LocalizationContext).l10n,g=r.useRef(),h=r.useState(""),p=h[0],f=h[1],d=s&&s.thumbnail?s.thumbnail.thumbnailLabel:"Thumbnail of page {{pageIndex}}";return r.useEffect((function(){var e=g.current;e&&e.cancel();var t=document.createElement("canvas"),r=t.getContext("2d",{alpha:!1}),i=l,o=i/(u/a),s=i/u;t.height=o,t.width=i,t.style.height=o+"px",t.style.width=i+"px";var h=n.getViewport({rotation:c,scale:s});g.current=n.render({canvasContext:r,viewport:h}),g.current.promise.then((function(){return f(t.toDataURL())}),(function(){}))}),[c]),p?r.createElement("img",{"aria-label":d.replace("{{pageIndex}}",""+(i+1)),src:p,height:o+"px",width:l+"px"}):r.createElement(t.Spinner,null)},o=function(e){var n=e.doc,a=e.isActive,i=e.pageHeight,u=e.pageIndex,o=e.pageWidth,l=e.rotation,s=e.onActive,g=r.useState({height:i,isCalculated:!1,page:null,viewportRotation:0,width:o}),h=g[0],p=g[1],f=r.useRef({isVisible:!1,ratio:0}),d=h.isCalculated,m=h.page,b=h.height,v=h.width,E=v/b,x=Math.abs(l)%180==0,P=x?100:100/E,w=x?100/E:100;r.useLayoutEffect((function(){if(a){var e=y.current,t=f.current;(!t.isVisible||t.ratio<1)&&s(e)}}),[a]);var _=(l+h.viewportRotation)%360,y=t.useIntersectionObserver({onVisibilityChanged:function(e){f.current=e,e.isVisible&&!d&&n.getPage(u+1).then((function(e){var t=e.getViewport({scale:1});p({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return r.createElement("div",{className:"rpv-thumbnail__container",ref:y,style:{height:w+"px",width:P+"px"}},m?r.createElement(c,{page:m,pageHeight:x?b:v,pageIndex:u,pageWidth:x?v:b,rotation:_,thumbnailHeight:w,thumbnailWidth:P}):r.createElement(t.Spinner,null))},l=function(e){var n=e.currentPage,a=e.doc,i=e.pageHeight,c=e.pageWidth,l=e.renderCurrentPageLabel,s=e.rotation,g=e.onJumpToPage,h=a.numPages,p=r.useRef(null),f=r.useRef([]),d=r.useState(n),m=d[0],b=d[1],v=r.useContext(t.ThemeContext).direction===t.TextDirection.RightToLeft,E=function(e){var t=p.current;t&&function(e,t){var n=e.getBoundingClientRect().top-t.getBoundingClientRect().top,r=e.clientHeight,a=t.clientHeight;n<0?t.scrollTop+=n:n+r<=a||(t.scrollTop+=n+r-a)}(e.parentElement,t)},x=function(e){switch(e.key){case"ArrowDown":P();break;case"ArrowUp":w();break;case"Enter":_()}},P=function(){if(p.current){var e=f.current,t=m+1;t<e.length&&(m>=0&&e[m].setAttribute("tabindex","-1"),b(t))}},w=function(){if(p.current){var e=f.current,t=m-1;t>=0&&(m>=0&&e[m].setAttribute("tabindex","-1"),b(t))}},_=function(){m>=0&&m<h&&g(m)};return t.useIsomorphicLayoutEffect((function(){var e=p.current;e&&(f.current=Array.from(e.querySelectorAll(".rpv-thumbnail__item")))}),[]),r.useEffect((function(){var e=f.current;if(!(0===e.length||m<0||m>e.length)){var t=e[m];t.setAttribute("tabindex","0"),t.focus()}}),[m]),r.createElement(u,{doc:a},(function(e){var u=e.length;return r.createElement("div",{ref:p,"data-testid":"thumbnail__list",className:t.classNames({"rpv-thumbnail__list":!0,"rpv-thumbnail__list--rtl":v}),onKeyDown:x},Array(h).fill(0).map((function(p,f){var d=u===h?e[f]:""+(f+1),m=l?l({currentPage:n,pageIndex:f,numPages:h,pageLabel:d}):d;return r.createElement("div",{key:"thumbnail-"+f},r.createElement("div",{className:t.classNames({"rpv-thumbnail__item":!0,"rpv-thumbnail__item--selected":n===f}),role:"button",tabIndex:n===f?0:-1,onClick:function(){return g(f)}},r.createElement(o,{doc:a,isActive:n===f,pageHeight:i,pageIndex:f,pageWidth:c,rotation:s,onActive:E})),r.createElement("div",{className:"rpv-thumbnail__index"},m))})))}))},s=function(e){var n=e.renderCurrentPageLabel,a=e.store,i=r.useState(a.get("doc")),u=i[0],c=i[1],o=r.useState(a.get("currentPage")||0),s=o[0],g=o[1],h=r.useState(a.get("pageHeight")||0),p=h[0],f=h[1],d=r.useState(a.get("pageWidth")||0),m=d[0],b=d[1],v=r.useState(a.get("rotation")||0),E=v[0],x=v[1],P=function(e){g(e)},w=function(e){c(e)},_=function(e){f(e)},y=function(e){b(e)},C=function(e){x(e)};return r.useEffect((function(){return a.subscribe("doc",w),a.subscribe("pageHeight",_),a.subscribe("pageWidth",y),a.subscribe("rotation",C),function(){a.unsubscribe("doc",w),a.unsubscribe("pageHeight",_),a.unsubscribe("pageWidth",y),a.unsubscribe("rotation",C)}}),[]),t.useIsomorphicLayoutEffect((function(){return a.subscribe("currentPage",P),function(){a.unsubscribe("currentPage",P)}}),[]),u?r.createElement(l,{currentPage:s,doc:u,pageHeight:p,pageWidth:m,renderCurrentPageLabel:n,rotation:E,onJumpToPage:function(e){var t=a.get("jumpToPage");t&&t(e)}}):r.createElement("div",{className:"rpv-thumbnail__loader"},r.createElement(t.Spinner,null))};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */exports.thumbnailPlugin=function(e){var n=r.useMemo((function(){return t.createStore({})}),[]);return{install:function(e){n.update("jumpToPage",e.jumpToPage)},onDocumentLoad:function(e){n.update("doc",e.doc)},onViewerStateChange:function(e){return n.update("currentPage",e.pageIndex),n.update("pageHeight",e.pageHeight),n.update("pageWidth",e.pageWidth),e},Cover:function(e){return r.createElement(i,a({},e,{store:n}))},Thumbnails:function(){return r.createElement(s,{renderCurrentPageLabel:null==e?void 0:e.renderCurrentPageLabel,store:n})}}};
